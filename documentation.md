# VKinder
**Vkinder** - это приложение ВКонтакте для знакомств. Представляет собой чат-бот, позволяющий находить людей, используя информацию (возраст, пол, город) о пользователе, который общается с ботом

### Настройка
Перед запуском стартового модуля **teamwork.py** необходимо:
1. Создать сообщество Вконтакте и получить токен сообщества в настройках
2. Создать базу данных, используя СУБД Postgres
3. Требуется установить библиотеки командой:  
`pip intstall -r requirements.txt`
4. Задать следующие переменные окружения в файле **.env**:

| Имя переменной | Описание значения переменной                      |
|----------------|---------------------------------------------------|
| VK_TOKEN       | Ключ сообщества (Access token), полученный в настройках сообщества                                                  |
| NAME_DB        | Имя базы данных                                   |
| USER_DB        | Имя пользователя для подключения к базе данных    |
| PASSWORD_DB    | Пароль пользователя для подключения к базе данных |
| HOST_DB        | Название хоста для подключения в базе данных      |
| POST_DB        | Порт для подключения к базе данных                |


### Команды бота


**“Найти человека”** – осуществляется поиск пользователей по следующим выбранным параметрам:
пол, город, возраст минимальный и максимальный. В результате поиска в чат бот выведет фамилию, имя первого найденного пользователя, ссылку на его профиль ВК, а также топ-3 фото его профиля.

**“Добавить в избранное”** – добавление пользователя в список избранных. В базе данных это таблица 'favorites'.

**“Список избранных”** – выводит в чат список избранных по форме: ссылка на профиль, имя и фамилия

**“Следующий”** – переход к следующему из найденных пользователей.

**"Помощь"** - выводит в чат доступные команды для управления ботом


### Модули
**teamwork** - основной модуль, используется для запуска бота

-`create_main_keyboard():` - функция для создания клавиатуры из двух кнопок "Найти человека" и "Список избранных"

-`create_search_keyboard():` - функция для создания клавиатуры, состоящей из кнопок "Добавить в избранное", "Добавить в черный список", "Следующий", "Назад"

-`create_photo_like_keyboard()` - функция для создания кнопки для того, чтобы поставить лайк фото

-`create_city_selection_keyboard()` - функция для создания клавиатуры для выбора города

-`create_cancel_keyboard()` - функция для создания в чате кнопки отмены

-`write_msg()`- Функция для отправки от имени бота сообщений в чат.

-`calculate_age()` - функция, высчитывающая возраст по дате рождения, возвращает число int

-`handle_set_search_params` - функция для отправки в чат сообщения "Введите минимальный возраст (например, 18):"

-`handle_search_params_input` - функция для получения через чат от пользователя информации для поиска

-`handle_find_person_with_params()` - функция для поиска кандидата, используя полученые от пользователя параметры params

-`handle_next_person(user_id)` - функция для выведения в чат следующего  пользователя из списка найденных по заданным параметрам

-`handle_add_favorite(user_id)` - используя выбранный в чате user_id - VK ID нужного человека, добавляет в Избранное

-`handle_list_favorites(user_id)` - Функция для отправки в чат списка избранных, выводит имя, фамилию, ссылку на профиль 

-`handle_add_blacklist()` - используя выбранный в чате user_id - VK ID нежелательного человека, добавляет в Черный Список


**database** - предназначен для работы с базой данных

`class DataBase()` - класс позволяет создать экземпляр класса, применять к нему методы для управления Базой данных

Методы класса DataBase:

- `create_database_structure` - ипользуется для создания структуры Базы Данных, создает таблицы Users - пользователи бота, SearchUser - найденные люди, Favorites - избранные, BlackList - черный список

- `user_insert` - добавляет пользователя по id в таблицу Users

- `searchuser_insert`- добавляет найденного пользователя по vk_id - VK ID, first_name - имя, 
last_name - фамилия, city - город, age - возраст в таблицу SearchUser

- `favorites_insert`- добавляет пользователя по favorite_vk_id - VK ID избранного, user_vk_id - VK ID пользователя в избранное, в таблицу Favorites

- `blacklist_insert`- добавляет пользователя по blacklist_vk_id - VK ID избранного, user_vk_id - VK ID пользователя в черный список, в таблицу BlackList

- `get_info_favorite`- используя vk_id_user - VK ID пользователя, возращает список избранных в виде ссылки на профиль, имя и фамилия

- `get_blacklist`- используя vk_id_user - VK ID пользователя, возращает список людей, добавленных в Черный Список в виде ссылки на профиль, имя и фамилия

- `update_searchuser` - обновляет информацию о найденном пользователе в таблице SearchUser

- `delete_favorite`- используя favorite_vk_id - VK ID избранного, user_vk_id - VK ID пользователя, удаляет избранного человека у конкретного пользователя

- `delete_searchuser`- используя vk_id - VK ID найденного человека, удаляет из таблицы SearchUser

- `delete_all_data`- удаляет данные из всех таблиц

- `is_exist_searchuser`- по VK ID проверяет существование найденного пользователя в таблице SearchUser, возращает True, есть он есть, False, если нет 

- `is_exist_favorite`- по VK ID проверяет существование избранного в таблице Favotites, возращает True, есть он есть, False, если нет

- `is_exist_user`- по VK ID проверяет существование  пользователя бота в таблице Users, возращает True, есть он есть, False, если нет

- `is_exist_blackuser`- по VK ID проверяет существование пользователя в Черном Списке, в таблице BlackList, возращает True, есть он есть, False, если нет




**vk_integration** - модуль для вазимодействия с VK API

`class VKInteraction` - с помощью данного класса можно создать экземпляр и применять к нему методы работы с VK API

-`get_user_info()` - используя параметры user_id - ID пользователя  и fields - дополнительные поля, возращает словарь с информацией о пользователе

-`user_search()` - используя параметры age_from -минимальный возраст, age_to - максимальный возраст, sex - Пол (1 - женский, 2 - мужской), 
city - ID города, count - количество возвращаемых людей (макс. 1000), возращает список людей подходящих под парамметры. в случае ошибки возвращает пустой список

-`get_user_photos()` - используя параметры user_id - ID полизователя VK, count - количество фотографий, 
возвращает список Attachment фотографий или пустой список в случае ошибки

-`get_like_to_photo()` - используя параметры owner_id - ID владельца фото, photo_id - ID фотографии, ставит лайк на фото, возращает True, если успешно, False, если нет.

-`get_cities()` - используя параметр city_name - название города, возращает список ID городов


**get_token** - модуль для получения токена пользователя

-`def get_token_with_selenium()` - фукнция, возвращающая user_token -токен пользователя. Формирует URL для OAuth-авторизации в VK, использует библиотеки selenium и webdriver_manager



